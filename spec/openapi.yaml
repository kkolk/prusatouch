openapi: 3.0.1
info:
  title: PrusaTouch API (PrusaLink v1 + Legacy Movement)
  description: 'Merged API: PrusaLink v1 for jobs/files + Legacy API for movement controls'
  contact:
    email: link@prusa3d.cz
  license:
    name: AGPLv3
  version: 1.0.0-draft
externalDocs:
  description: Find out more about API
  url: https://connect.prusa3d.com
security:
- digestAuth: []
paths:
  /api/version:
    get:
      summary: Get API version information
      description: |
        Returns version information for PrusaLink API and firmware.

        **Use Cases:**
        - Initial connection: Verify API compatibility
        - Feature detection: Check capabilities field
        - Debug logging: Include version info in bug reports

        **Polling:** This is static information. Only fetch once on app startup.

        **Note:** No authentication required for this endpoint.
      responses:
        200:
          description: Version information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Version'
              examples:
                mk3s:
                  summary: Prusa MK3S+ with PrusaLink
                  value:
                    api: "2.0.0"
                    server: "2.1.2"
                    text: "PrusaLink 2.1.2"
                    firmware: "3.13.3"
                    sdk: "2.1.2"
                    capabilities:
                      upload-by-put: true
        401:
          $ref: '#/components/responses/Unauthorized'
  /api/v1/info:
    get:
      summary: Get printer information
      description: |
        Returns static information about the printer hardware and configuration.

        **Information Includes:**
        - Printer name and model (e.g., "Original Prusa MK3S+")
        - Serial number
        - Network information (hostname, IP)
        - SD card presence
        - MMU (multi-material unit) status

        **Use Cases:**
        - Display printer name in UI header
        - Identify printer in multi-printer setup
        - Feature detection (MMU, SD card support)

        **Polling:** This is mostly static. Only fetch once on app startup, or when
        configuration might change (rare).

        **Note:** Serial number should not be displayed publicly for privacy reasons.
      responses:
        200:
          description: Printer information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Info'
              examples:
                mk3s:
                  summary: Prusa MK3S+ configuration
                  value:
                    name: "My Prusa MK3S+"
                    location: "Workshop"
                    farm_mode: false
                    nozzle_diameter: 0.4
                    min_extrusion_temp: 170
                    serial: "CZPX1234X567XC12345"
                    hostname: "prusa-mk3s"
                    port: 80
        401:
          $ref: '#/components/responses/Unauthorized'
  /api/v1/status:
    get:
      summary: Get complete printer status (telemetry)
      description: |
        Returns real-time status of printer, including temperatures, position,
        current job progress, and file transfers.

        **This is the PRIMARY POLLING ENDPOINT** for live printer monitoring.

        **Status Includes:**
        - **printer** (required): State, temps (nozzle/bed), axis positions, fan speed
        - **job** (optional): Current job progress, time remaining, file being printed
        - **transfer** (optional): File upload/download progress
        - **storage** (optional): Storage space usage
        - **camera** (optional): Camera status if available

        **Adaptive Polling Strategy (CRITICAL for performance):**
        - **Printing:** Poll every 2000ms (2 seconds) for smooth progress updates
        - **Idle:** Poll every 5000ms (5 seconds) to conserve CPU
        - **Offline:** Stop polling, retry connection every 5s

        **Connection Handling:**
        - First failure: Silent retry after 1s
        - Second failure: Retry after 2s, show toast notification
        - Third failure: Show "PrusaLink Offline" banner, stop polling
        - Recovery: Auto-resume polling when connection restored

        **Temperature Fields:**
        - All temperatures in Celsius (°C)
        - Accuracy: ±1°C typical
        - `actual`: Current measured temperature
        - `target`: Desired temperature (0 = heater off)

        **Position Fields:**
        - All positions in millimeters (mm)
        - Only available when printer is idle (not moving)
        - May be null during printing or movement

        **Performance Note:** This endpoint is called frequently. Optimize parsing
        and state updates on client side.
      responses:
        200:
          description: Status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  job:
                    $ref: '#/components/schemas/StatusJob'
                  printer:
                    $ref: '#/components/schemas/StatusPrinter'
                  transfer:
                    $ref: '#/components/schemas/StatusTransfer'
                  storage:
                    $ref: '#/components/schemas/StatusStorage'
                  camera:
                    $ref: '#/components/schemas/StatusCamera'
                required:
                - printer
              examples:
                printing:
                  summary: Active print job
                  value:
                    printer:
                      state: PRINTING
                      temp_nozzle: 215.0
                      target_nozzle: 215.0
                      temp_bed: 60.0
                      target_bed: 60.0
                      axis_x: 125.5
                      axis_y: 105.2
                      axis_z: 45.8
                      flow: 100
                      speed: 100
                      fan_hotend: 0
                      fan_print: 255
                    job:
                      id: 42
                      progress: 0.45
                      time_remaining: 3600
                      time_printing: 1800
                idle:
                  summary: Printer idle
                  value:
                    printer:
                      state: IDLE
                      temp_nozzle: 25.0
                      target_nozzle: 0.0
                      temp_bed: 24.0
                      target_bed: 0.0
                      axis_x: 0.0
                      axis_y: 0.0
                      axis_z: 0.0
                      flow: 100
                      speed: 100
                      fan_hotend: 0
                      fan_print: 0
        401:
          $ref: '#/components/responses/Unauthorized'
  /api/v1/job:
    get:
      summary: Get current job information
      description: |
        Returns information about the currently active print job, if any.

        **Job States:**
        - `IDLE`: No job active
        - `PRINTING`: Job is actively printing
        - `PAUSED`: Job is paused
        - `FINISHED`: Job completed successfully
        - `STOPPED`: Job was cancelled/stopped
        - `ERROR`: Job failed with error

        **Polling:** Client should poll this endpoint every 2-5 seconds while job is active
        to get updated progress, time remaining, and state.

        **Returns 204 (No Content)** when no job is active.
      responses:
        200:
          description: Job information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
              examples:
                printing:
                  summary: Job actively printing
                  value:
                    id: 42
                    state: PRINTING
                    progress: 0.45
                    time_remaining: 3600
                    time_printing: 1800
                paused:
                  summary: Job paused
                  value:
                    id: 42
                    state: PAUSED
                    progress: 0.65
                    time_printing: 2700
        204:
          description: No active job
        401:
          $ref: '#/components/responses/Unauthorized'
  /api/v1/job/{id}:
    parameters:
    - in: path
      name: id
      description: Unique job identifier
      required: true
      schema:
        type: integer
        example: 42
    delete:
      summary: Stop/cancel print job
      description: |
        Immediately stops and cancels the print job with the specified ID.

        **Behavior:**
        - Stops all movement and heating
        - Retracts filament (if configured)
        - Job state transitions to `STOPPED`
        - Cannot be resumed after stopping

        **State Requirements:**
        - Job must be in `PRINTING` or `PAUSED` state
        - Returns 409 Conflict if job is already finished or stopped

        **Safety Note:** This is a destructive operation. Always prompt user for
        confirmation before calling.
      responses:
        204:
          description: Job stopped successfully
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          description: Conflict - Job cannot be stopped (wrong state)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/job/{id}/pause:
    parameters:
    - in: path
      name: id
      description: Unique job identifier
      required: true
      schema:
        type: integer
        example: 42
    put:
      summary: Pause print job
      description: |
        Pauses the active print job, allowing it to be resumed later.

        **Behavior:**
        - Stops all movement immediately
        - Maintains current temperatures
        - Job state transitions to `PAUSED`
        - Progress and time elapsed are preserved

        **State Requirements:**
        - Job must be in `PRINTING` state
        - Returns 409 Conflict if job is not currently printing

        **Use Case:** User wants to temporarily pause print to inspect progress,
        change filament color, or handle other issues.
      responses:
        204:
          description: Job paused successfully
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          description: Conflict - Job cannot be paused (wrong state)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/job/{id}/resume:
    parameters:
    - in: path
      name: id
      description: Unique job identifier
      required: true
      schema:
        type: integer
        example: 42
    put:
      summary: Resume paused print job
      description: |
        Resumes a previously paused print job from where it left off.

        **Behavior:**
        - Waits for temperatures to stabilize (if changed)
        - Resumes movement from last position
        - Job state transitions back to `PRINTING`
        - Continues from previous progress percentage

        **State Requirements:**
        - Job must be in `PAUSED` state
        - Returns 409 Conflict if job is not paused

        **Timing:** May take 30-60 seconds to resume if temperatures need to reheat.
      responses:
        204:
          description: Job resumed successfully (or resuming)
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          description: Conflict - Job cannot be resumed (wrong state)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/job/{id}/continue:
    parameters:
    - in: path
      name: id
      description: Unique job identifier
      required: true
      schema:
        type: integer
        example: 42
    put:
      summary: Continue job after timelapse
      description: |
        Continues print job after a timelapse photo capture has paused it.

        **Behavior:**
        - Used specifically for timelapse workflow
        - Similar to resume, but for timelapse-triggered pauses
        - Job state transitions back to `PRINTING`

        **State Requirements:**
        - Job must be paused for timelapse capture
        - Returns 409 Conflict if not in correct state

        **Note:** This is a specialized endpoint for timelapse features.
        Most applications will use `/pause` and `/resume` instead.
      responses:
        204:
          description: Job continued successfully
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          description: Conflict - Job cannot be continued (wrong state)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/v1/storage:
    parameters:
    - in: header
      name: Accept-Language
      description: Defines a language of the response
      schema:
        type: string
        example: cs
    get:
      summary: List available storage locations
      description: |
        Returns information about each available file storage location.

        **Storage Types:**
        - `local`: Internal storage (built-in flash/SD card)
        - `sdcard`: External SD card (if present)

        **Use Cases:**
        - Initial app load: Check what storage is available
        - File browser: Show storage selection menu
        - Upload destination: Select target storage

        **Note:** Storage list is relatively static. No need to poll frequently.
      responses:
        200:
          description: Storage locations retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  storage_list:
                    type: array
                    items:
                      $ref: '#/components/schemas/Storage'
              examples:
                single_storage:
                  summary: Single local storage
                  value:
                    storage_list:
                      - name: "PrusaLink gcodes"
                        type: "LOCAL"
                        path: "/local"
                        read_only: false
                        free_space: 26843545600
                        total_space: 31914983424
                dual_storage:
                  summary: Local and SD card
                  value:
                    storage_list:
                      - name: "PrusaLink gcodes"
                        type: "LOCAL"
                        path: "/local"
                        read_only: false
                        free_space: 26843545600
                        total_space: 31914983424
                      - name: "SD Card"
                        type: "SDCARD"
                        path: "/sdcard"
                        read_only: false
                        free_space: 15728640000
                        total_space: 16106127360
        401:
          $ref: '#/components/responses/Unauthorized'
  /api/v1/transfer:
    get:
      summary: transfer info
      description: Returns info about current transfer
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transfer'
        204:
          description: No Content
        401:
          $ref: '#/components/responses/Unauthorized'
  /api/v1/transfer/{id}:
    parameters:
    - in: path
      name: id
      description: transfer id
      required: true
      schema:
        type: integer
        example: 42
    delete:
      summary: stop transfer
      description: Stop transfer with given id
      responses:
        204:
          description: No Content No Error
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          $ref: '#/components/responses/Conflict'
  /api/files/{storage}/{path}:
    parameters:
    - in: header
      name: Accept-Language
      description: Defines a language of the response
      schema:
        type: string
        example: cs
    - in: header
      name: Accept
      description: |
        Preferred content-type of response:
        - `application/json`: Get file/folder metadata
        - File download: Use file's actual content type
      schema:
        type: string
        default: application/json
        example: application/json
    - in: path
      name: storage
      description: Storage location identifier (e.g., "local", "sdcard")
      required: true
      schema:
        type: string
        example: local
    - in: path
      name: path
      description: |
        Path to the file or folder within the storage.
        Use "/" for root directory listing.
      required: true
      schema:
        type: string
        example: /examples/Spice_Harvester_0.3mm_PLA_MK3S_12m.gcode
    get:
      summary: Get file/folder metadata or download file
      description: |
        Multi-purpose endpoint for file operations:

        **With Accept: application/json:**
        - Returns file or folder metadata
        - For folders: Returns FolderInfo with children array
        - For files: Returns PrintFileInfo with size, date, thumbnails

        **For file download:**
        - Set Accept header to file's content type
        - Returns file content as binary stream

        **Thumbnails:**
        - Available via `refs.thumbnail` field in file metadata
        - Cached on client side (LRU cache recommended)
        - Multiple sizes may be available

        **Folder Navigation:**
        - Use path="/" to list root directory
        - Folders have `children` array in response
        - Files are sorted: folders first, then alphabetically
      responses:
        200:
          description: File or folder metadata retrieved successfully
          content:
            application/json:
              schema:
                oneOf:
                - $ref: '#/components/schemas/FileInfo'
                - $ref: '#/components/schemas/PrintFileInfo'
                - $ref: '#/components/schemas/FirmwareFileInfo'
                - $ref: '#/components/schemas/FolderInfo'
              examples:
                folder:
                  summary: Folder listing
                  value:
                    name: "examples"
                    type: "FOLDER"
                    ro: false
                    children:
                      - name: "test_print.gcode"
                        type: "PRINT_FILE"
                        size: 1234567
                        m_timestamp: 1672531200
                print_file:
                  summary: Print file metadata
                  value:
                    name: "test_print.gcode"
                    type: "PRINT_FILE"
                    size: 1234567
                    m_timestamp: 1672531200
                    refs:
                      thumbnail: "/thumb/local/test_print.gcode"
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
    put:
      summary: upload file or create folder
      requestBody:
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      parameters:
      - in: header
        name: Content-Length
        description: Length of file to upload
        schema:
          type: integer
          example: 101342
      - in: header
        name: Content-Type
        description: Type of uploaded media
        schema:
          type: string
          default: application/octet-stream
      - in: header
        name: Print-After-Upload
        description: Whether to start printing the file after upload
        schema:
          type: string
          description: ?0=False, ?1=True, according RFC8941/3.3.6
          enum:
          - ?0
          - ?1
          default: ?0
      - in: header
        name: Overwrite
        description: Whether to overwrite already existing files
        schema:
          type: string
          description: ?0=False, ?1=True, according RFC8941/3.3.6
          enum:
          - ?0
          - ?1
          default: ?0
      responses:
        201:
          description: Created
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          $ref: '#/components/responses/Conflict'
    post:
      summary: Start printing a file
      description: |
        Initiates a print job for the specified file.

        **Behavior:**
        - Validates file is a valid GCODE file
        - Checks no other job is currently active
        - Begins heating bed and nozzle to target temperatures
        - Starts print when temperatures stabilize

        **State Requirements:**
        - Printer must be in IDLE state
        - No active print job
        - File must be a PRINT_FILE type

        **Error Conditions:**
        - 404: File not found
        - 409: Printer busy (job already running)

        **Note:** Request body is ignored. File path from URL parameters is used.

        **Timing:** May take 2-5 minutes for temperatures to reach targets before
        print actually begins. Poll `/api/v1/job` to monitor state.
      requestBody:
        required: false
        content: {}
      responses:
        204:
          description: Print job started successfully (heating)
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          description: Conflict - Printer busy or invalid file type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    head:
      summary: file presence and state check
      responses:
        200:
          description: OK
          headers:
            Read-Only:
              description: Whether the file or storage is read-only
              required: true
              schema:
                type: boolean
                example: true
            Currently-Printed:
              description: Whether this file is currently being printed
              required: true
              schema:
                type: boolean
                example: true
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          $ref: '#/components/responses/Conflict'
    delete:
      summary: Delete a file or folder
      description: |
        Permanently deletes a file or folder from storage.

        **Behavior:**
        - Files: Immediately deleted
        - Empty folders: Deleted immediately
        - Non-empty folders: Requires `Force: ?1` header

        **Safety Checks:**
        - Cannot delete currently printing file (returns 409)
        - Cannot delete read-only files (returns 409)
        - Non-empty folders require explicit force flag

        **Warning:** This operation is irreversible. Deleted files cannot be recovered.
        Always prompt user for confirmation before calling.

        **Storage Impact:** Freed space becomes available immediately.
      parameters:
      - in: header
        name: Force
        description: |
          Force deletion of non-empty folders.
          Values according to RFC8941/3.3.6:
          - `?0`: False (default) - Reject non-empty folders
          - `?1`: True - Delete folder and all contents recursively
        schema:
          type: string
          enum:
          - ?0
          - ?1
          default: ?0
          example: ?0
      responses:
        204:
          description: File or folder deleted successfully
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          description: |
            Conflict - Cannot delete:
            - File is currently being printed
            - Folder is not empty and Force=?0
            - File or folder is read-only
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                currently_printing:
                  summary: File is being printed
                  value:
                    error: "Cannot delete file that is currently printing"
                folder_not_empty:
                  summary: Folder not empty
                  value:
                    error: "Cannot delete non-empty folder without Force header"
  /api/v1/cameras:
    get:
      summary: Get a list of active cameras and its properties
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Camera'
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
    put:
      summary: List of cameras in intended order
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
                description: Printer ID
                example: sh42arta
      responses:
        200:
          description: OK
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
  /api/v1/cameras/{id}:
    parameters:
    - in: path
      name: id
      description: ID of the camera
      required: true
      schema:
        type: string
        example: Z42D4U2NqEX
    get:
      summary: Get current settings and properties of specific camera
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CameraConfig'
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
    post:
      summary: Setup a new camera or fix a broken one
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CameraConfigSet'
      responses:
        200:
          description: OK
        400:
          $ref: '#/components/responses/BadRequest'
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          $ref: '#/components/responses/Conflict'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
    delete:
      summary: Delete a camera
      responses:
        200:
          description: OK
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          $ref: '#/components/responses/Conflict'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
  /api/v1/cameras/snap:
    get:
      summary: Return a captured image from the default camera
      responses:
        200:
          description: OK
          content:
            image/png:
              schema:
                type: string
                format: binary
        204:
          description: No Content No Error
        304:
          $ref: '#/components/responses/NotModified'
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
  /api/v1/cameras/{id}/snap:
    parameters:
    - in: path
      name: id
      description: ID of the camera
      required: true
      schema:
        type: string
        example: Z42D4U2NqEX
    get:
      summary: Return a captured image from the camera with a given id
      responses:
        200:
          description: OK
          content:
            image/png:
              schema:
                type: string
                format: binary
        204:
          description: No Content No Error
        304:
          $ref: '#/components/responses/NotModified'
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
    post:
      summary: Make a snapshot with the camera
      description: Can be manually done only during camera initialization or in manual mode
      requestBody:
        content:
          application/json: {}
      responses:
        200:
          description: OK
          content:
            image/png:
              schema:
                type: string
                format: binary
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        408:
          $ref: '#/components/responses/RequestTimeout'
        409:
          $ref: '#/components/responses/Conflict'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
  /api/v1/cameras/{id}/config:
    parameters:
    - in: path
      name: id
      description: ID of the camera
      required: true
      schema:
        type: string
        example: Z42D4U2NqEX
    patch:
      summary: Set new settings to a working camera
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CameraConfigSet'
      responses:
        200:
          description: OK
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
    delete:
      summary: Reset settings of a camera
      responses:
        200:
          description: OK
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
  /api/v1/cameras/{id}/connection:
    parameters:
    - in: path
      name: id
      description: ID of the camera
      required: true
      schema:
        type: string
        example: Z42D4U2NqEX
    post:
      summary: Register a camera to Connect
      responses:
        200:
          description: OK
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        408:
          $ref: '#/components/responses/RequestTimeout'
        409:
          $ref: '#/components/responses/Conflict'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
    delete:
      summary: Un-register a camera from Connect
      responses:
        200:
          description: OK
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          $ref: '#/components/responses/Forbidden'
        404:
          $ref: '#/components/responses/NotFound'
        409:
          $ref: '#/components/responses/Conflict'
        503:
          $ref: '#/components/responses/ServiceUnavailable'
  /api/v1/update/{env}:
    parameters:
    - in: path
      name: env
      description: The target environment (prusalink or system) for update
      required: true
      schema:
        type: string
        enum:
        - prusalink
    get:
      summary: Retrieve information about available update of given environment
      responses:
        200:
          description: OK
          headers:
            Update-Available:
              schema:
                type: boolean
                description: Whether there's a package update available
                example: true
          content:
            application/json:
              schema:
                oneOf:
                - $ref: '#/components/schemas/PrusaLinkPackage'
        204:
          description: No Content
          headers:
            Update-Available:
              schema:
                type: boolean
                description: Whether there's a package update available
                example: false
        401:
          $ref: '#/components/responses/Unauthorized'
        409:
          $ref: '#/components/responses/BadRequest'
    post:
      summary: Update given environment
      responses:
        200:
          description: OK
        204:
          description: No Content
        401:
          $ref: '#/components/responses/Unauthorized'
        409:
          $ref: '#/components/responses/BadRequest'
  /api/settings:
    get:
      summary: Get all printer settings
      description: |
        Returns complete configuration settings for the printer, user account, and API access.

        **Settings Categories:**
        - **printer**: Name, location, network error chime
        - **username**: Current username for digest auth
        - **api-key**: API key for non-interactive access

        **Use Cases:**
        - Initial app load: Populate settings UI
        - Settings screen: Display current configuration
        - Profile management: Show user account details

        **Polling:** This is static configuration. Only fetch when entering settings screen.

        **Note:** Password is never returned for security reasons.
      responses:
        200:
          description: Settings retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Settings'
              examples:
                full_config:
                  summary: Complete settings response
                  value:
                    printer:
                      name: "My Prusa MK3S+"
                      location: "Workshop"
                      network_error_chime: true
                    username: "maker"
                    api-key: "AbCdEf123456"
        401:
          $ref: '#/components/responses/Unauthorized'
    post:
      summary: Update printer settings
      description: |
        Updates printer configuration and/or user credentials.

        **Update Behavior:**
        - Only provided fields are updated
        - Omitted fields remain unchanged
        - All updates are applied atomically

        **Printer Settings:**
        - `name`: Printer display name (shown in UI and network discovery)
        - `location`: Physical location description
        - `network_error_chime`: Enable/disable sound on network errors

        **User Settings:**
        - Requires current password to make any user changes
        - `username`: Change username for digest auth
        - `new_password`: Set new password
        - `new_repassword`: Confirm new password (must match)

        **Validation:**
        - Printer name: Required, 1-64 characters
        - Location: Required, 1-64 characters
        - Username: 3-32 alphanumeric characters
        - Password: Minimum 8 characters
        - Password confirmation must match exactly

        **Note:** Changes take effect immediately, no restart required.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SettingsUpdate'
            examples:
              update_printer:
                summary: Update printer settings only
                value:
                  printer:
                    name: "Prusa MK3S+ (Workshop)"
                    location: "Main Workshop - Bay 3"
                  network_error_chime: false
              update_username:
                summary: Change username
                value:
                  user:
                    password: "current-password"
                    username: "newusername"
              change_password:
                summary: Change password
                value:
                  user:
                    password: "current-password"
                    new_password: "new-secure-password"
                    new_repassword: "new-secure-password"
      responses:
        200:
          description: Settings updated successfully
        400:
          description: Bad Request - Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                password_mismatch:
                  summary: Password confirmation mismatch
                  value:
                    title: "Validation Error"
                    text: "Password confirmation does not match new password"
                invalid_username:
                  summary: Invalid username format
                  value:
                    title: "Validation Error"
                    text: "Username must be 3-32 alphanumeric characters"
        401:
          $ref: '#/components/responses/Unauthorized'
        403:
          description: Forbidden - Incorrect current password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/settings/sn:
    get:
      summary: Get printer serial number
      description: |
        Returns the printer's serial number if configured.

        **Serial Number States:**
        - Configured: Returns serial number string
        - Not configured: Returns null or empty string
        - Error state: Printer may require serial number to be set

        **Use Case:** Display serial number in settings or about screen.

        **Note:** Some printers require serial number to be set for full functionality.
      responses:
        200:
          description: Serial number retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  serial:
                    type: string
                    nullable: true
                    description: Printer serial number, or null if not set
                    example: "CZPX1234X567XC12345"
                required:
                  - serial
              examples:
                configured:
                  summary: Serial number configured
                  value:
                    serial: "CZPX1234X567XC12345"
                not_configured:
                  summary: Serial number not set
                  value:
                    serial: null
        401:
          $ref: '#/components/responses/Unauthorized'
    post:
      summary: Set printer serial number
      description: |
        Sets or updates the printer's serial number.

        **Behavior:**
        - Can only be set once on some printer models
        - Once set, serial number may be immutable
        - Used for warranty tracking and printer identification

        **Validation:**
        - Format: CZPX####X###XC##### (varies by model)
        - Must match Prusa serial number format
        - Cannot be empty or null

        **Use Case:** Initial printer setup or error recovery when serial number is missing.

        **Warning:** This operation may be permanent on some printer models.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                serial:
                  type: string
                  description: Printer serial number in Prusa format
                  example: "CZPX1234X567XC12345"
              required:
                - serial
      responses:
        200:
          description: Serial number set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  serial:
                    type: string
                    description: Confirmed serial number
                    example: "CZPX1234X567XC12345"
        400:
          description: Bad Request - Invalid serial number format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        401:
          $ref: '#/components/responses/Unauthorized'
        409:
          description: Conflict - Serial number already set and cannot be changed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/settings/apikey:
    post:
      summary: Reset/regenerate API key
      description: |
        Generates a new API key and invalidates the old one.

        **Behavior:**
        - Creates new random API key
        - Old API key is immediately invalidated
        - All clients using old key must update

        **Use Cases:**
        - Security: Rotate API keys periodically
        - Compromise: Revoke access if key is leaked
        - Setup: Generate initial API key

        **Security Note:** This operation requires digest authentication.
        API key alone cannot be used to reset itself.
      responses:
        200:
          description: New API key generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  api-key:
                    type: string
                    description: Newly generated API key
                    example: "XyZ789AbCdEf456"
                required:
                  - api-key
              examples:
                new_key:
                  summary: New API key response
                  value:
                    api-key: "XyZ789AbCdEf456"
        401:
          $ref: '#/components/responses/Unauthorized'
  /api/logs:
    get:
      summary: List available log files
      description: |
        Returns a list of available log files with metadata.

        **Log Types:**
        - PrusaLink application logs
        - System logs (if available)
        - Error logs

        **File Information:**
        - `name`: Log filename
        - `size`: File size in bytes (null if unknown)
        - `date`: Last modification timestamp

        **Use Cases:**
        - Settings/diagnostics screen: Show available logs
        - Support: Allow users to download logs for troubleshooting
        - Monitoring: Check log file sizes for disk space management

        **Note:** Log files can be large. Check size before attempting to display inline.
      responses:
        200:
          description: Log files list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  files:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          description: Log filename
                          example: "prusalink.log"
                        size:
                          type: integer
                          nullable: true
                          description: File size in bytes, null if unknown
                          example: 1048576
                        date:
                          type: integer
                          description: Last modification timestamp (Unix epoch)
                          example: 1672531200
                      required:
                        - name
                        - size
                        - date
                required:
                  - files
              examples:
                log_list:
                  summary: Available log files
                  value:
                    files:
                      - name: "prusalink.log"
                        size: 1048576
                        date: 1672531200
                      - name: "prusalink.log.1"
                        size: 2097152
                        date: 1672444800
                      - name: "error.log"
                        size: 512000
                        date: 1672358400
        401:
          $ref: '#/components/responses/Unauthorized'
  /api/logs/{filename}:
    parameters:
    - in: path
      name: filename
      description: Log filename to retrieve
      required: true
      schema:
        type: string
        example: prusalink.log
    get:
      summary: Download log file
      description: |
        Downloads the specified log file as plain text.

        **Behavior:**
        - Returns raw log file content
        - Content-Type: text/plain
        - Suitable for download or display

        **Size Limits:**
        - Files larger than 64MB may not be displayable in browser
        - Consider download-only for very large files
        - Check file size from `/api/logs` before fetching

        **Use Cases:**
        - Download logs for support tickets
        - Display recent logs in diagnostics UI
        - Automated log collection for monitoring

        **Performance Note:** Large log files can take significant time to transfer
        on slow networks. Consider streaming or pagination for UI display.
      responses:
        200:
          description: Log file retrieved successfully
          content:
            text/plain:
              schema:
                type: string
                description: Raw log file content
                example: |
                  2024-01-01 12:00:00 INFO Starting PrusaLink...
                  2024-01-01 12:00:01 INFO Connected to printer
                  2024-01-01 12:00:02 INFO Ready
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete log file
      description: |
        Deletes the specified log file from the system.

        **Behavior:**
        - Permanently removes the log file
        - Cannot delete currently active log file
        - Returns 204 on successful deletion

        **Use Cases:**
        - Clean up old rotated log files
        - Free up storage space
        - Remove logs after download for support

        **Note:** This endpoint may not be supported by all PrusaLink versions.
        Check for 404/405 responses to determine availability.
      responses:
        204:
          description: Log file deleted successfully
        401:
          $ref: '#/components/responses/Unauthorized'
        404:
          description: Log file not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        409:
          description: Cannot delete active log file
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/connection:
    get:
      summary: Get PrusaConnect connection status
      description: |
        Returns status of printer connections to PrusaConnect cloud service and serial port.

        **Connection Types:**
        - **connect**: PrusaConnect cloud service registration and status
        - **current**: Serial port connection to printer (for Raspberry Pi installations)

        **PrusaConnect Registration States:**
        - `NOT_STARTED`: Registration not initiated
        - `IN_PROGRESS`: Currently registering with PrusaConnect
        - `FINISHED`: Successfully registered
        - `FAILED`: Registration failed

        **Use Cases:**
        - Settings screen: Display cloud connection status
        - Initial setup: Show registration progress
        - Diagnostics: Check printer communication status

        **Polling:** Poll every 5-10 seconds during registration, otherwise fetch only when
        viewing settings screen.
      responses:
        200:
          description: Connection status retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionStatus'
              examples:
                registered:
                  summary: Successfully registered to PrusaConnect
                  value:
                    connect:
                      hostname: "connect.prusa3d.com"
                      port: 0
                      tls: 1
                      registration: "FINISHED"
                    current:
                      port: "/dev/ttyACM0"
                      baudrate: 115200
                not_registered:
                  summary: Not registered to PrusaConnect
                  value:
                    connect:
                      hostname: ""
                      port: 0
                      tls: 0
                      registration: "NOT_STARTED"
                    current:
                      port: "/dev/ttyACM0"
                      baudrate: 115200
        401:
          $ref: '#/components/responses/Unauthorized'
    post:
      summary: Register printer with PrusaConnect
      description: |
        Initiates registration of printer with PrusaConnect cloud service.

        **Registration Flow:**
        1. Send hostname, port, and TLS settings
        2. PrusaLink initiates registration with PrusaConnect
        3. Server returns URL for user to complete registration in browser
        4. Poll GET /api/connection to check registration status

        **Required Settings:**
        - `hostname`: PrusaConnect server hostname
        - `port`: Server port (0 for default)
        - `tls`: Use HTTPS (1) or HTTP (0)

        **Timing:** Registration typically takes 10-30 seconds. Poll status endpoint
        to detect completion.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                connect:
                  type: object
                  properties:
                    hostname:
                      type: string
                      description: PrusaConnect server hostname
                      example: "connect.prusa3d.com"
                    port:
                      type: integer
                      description: Server port (0 for default 443/80)
                      example: 0
                    tls:
                      type: integer
                      description: Use TLS/HTTPS (1=yes, 0=no)
                      enum: [0, 1]
                      example: 1
                  required:
                    - hostname
                    - port
                    - tls
              required:
                - connect
            examples:
              register_production:
                summary: Register with production PrusaConnect
                value:
                  connect:
                    hostname: "connect.prusa3d.com"
                    port: 0
                    tls: 1
      responses:
        200:
          description: Registration initiated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    format: uri
                    description: URL to complete registration in browser
                    example: "https://connect.prusa3d.com/register?code=ABC123"
              examples:
                registration_url:
                  summary: Registration URL response
                  value:
                    url: "https://connect.prusa3d.com/register?code=ABC123"
        400:
          $ref: '#/components/responses/BadRequest'
        401:
          $ref: '#/components/responses/Unauthorized'
    delete:
      summary: Unregister printer from PrusaConnect
      description: |
        Removes printer registration from PrusaConnect cloud service.

        **Behavior:**
        - Disconnects from PrusaConnect
        - Deletes stored registration credentials
        - Cannot be undone - requires re-registration

        **Use Cases:**
        - Decommissioning printer
        - Switching to different PrusaConnect account
        - Privacy: Disable cloud connectivity

        **Note:** This does not affect local network access to PrusaLink.
      responses:
        200:
          description: Printer unregistered successfully
        401:
          $ref: '#/components/responses/Unauthorized'
        409:
          description: Conflict - Printer not currently registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/printer/printhead:
    post:
      summary: Control printhead movement, speed, and steppers
      description: |
        Accepts commands for printhead control. The API uses a flat command structure
        with discriminated unions based on the `command` field.

        **Commands:**
        - `jog`: Move printhead in X/Y/Z axes (relative movement)
        - `home`: Home one or more axes to endstops
        - `speed`: Set print speed factor (percentage)
        - `feedrate`: Set feedrate factor (percentage, alias for speed)
        - `disable_steppers`: Disable all stepper motors

        **Note:** 503 responses indicate printer is busy (steppers disabled), but the
        command is queued and will execute when steppers wake up.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/PrintheadJogCommand'
                - $ref: '#/components/schemas/PrintheadHomeCommand'
                - $ref: '#/components/schemas/PrintheadSpeedCommand'
                - $ref: '#/components/schemas/PrintheadFeedrateCommand'
                - $ref: '#/components/schemas/PrintheadDisableSteppersCommand'
              discriminator:
                propertyName: command
                mapping:
                  jog: '#/components/schemas/PrintheadJogCommand'
                  home: '#/components/schemas/PrintheadHomeCommand'
                  speed: '#/components/schemas/PrintheadSpeedCommand'
                  feedrate: '#/components/schemas/PrintheadFeedrateCommand'
                  disable_steppers: '#/components/schemas/PrintheadDisableSteppersCommand'
            examples:
              jog:
                summary: Jog X axis 10mm
                value:
                  command: jog
                  x: 10
              jog_multi:
                summary: Jog multiple axes
                value:
                  command: jog
                  x: 10
                  y: -5
                  z: 0.2
              home_all:
                summary: Home all axes
                value:
                  command: home
                  axes: [x, y, z]
              home_z:
                summary: Home Z axis only
                value:
                  command: home
                  axes: [z]
              speed:
                summary: Set speed to 105%
                value:
                  command: speed
                  factor: 105
              disable:
                summary: Disable steppers
                value:
                  command: disable_steppers
      responses:
        204:
          description: Command accepted and executed successfully
        400:
          $ref: '#/components/responses/BadRequest'
        409:
          $ref: '#/components/responses/Conflict'
        503:
          description: Service Unavailable - Printer busy (steppers disabled), command queued
  /api/printer/tool:
    post:
      summary: Control extruder (nozzle) temperature and extrusion
      description: |
        Accepts commands for extruder/nozzle control. The API uses a flat command structure
        with discriminated unions based on the `command` field.

        **Commands:**
        - `target`: Set target temperature for nozzle (requires nested targets object)
        - `offset`: Set temperature offset (requires nested offsets object)
        - `select`: Select active tool (for multi-extruder printers)
        - `extrude`: Extrude filament by specified amount (mm)
        - `flowrate`: Set extrusion flowrate factor (percentage)

        **Note:** For `extrude` command, use negative amounts to retract.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/ToolTargetCommand'
                - $ref: '#/components/schemas/ToolOffsetCommand'
                - $ref: '#/components/schemas/ToolSelectCommand'
                - $ref: '#/components/schemas/ToolExtrudeCommand'
                - $ref: '#/components/schemas/ToolFlowrateCommand'
              discriminator:
                propertyName: command
                mapping:
                  target: '#/components/schemas/ToolTargetCommand'
                  offset: '#/components/schemas/ToolOffsetCommand'
                  select: '#/components/schemas/ToolSelectCommand'
                  extrude: '#/components/schemas/ToolExtrudeCommand'
                  flowrate: '#/components/schemas/ToolFlowrateCommand'
            examples:
              target:
                summary: Set nozzle temperature to 220°C
                value:
                  command: target
                  targets:
                    tool0: 220
              extrude:
                summary: Extrude 5mm of filament
                value:
                  command: extrude
                  amount: 5
              retract:
                summary: Retract 3mm of filament
                value:
                  command: extrude
                  amount: -3
              flowrate:
                summary: Set flowrate to 95%
                value:
                  command: flowrate
                  factor: 95
      responses:
        204:
          description: Command accepted and executed successfully
        400:
          $ref: '#/components/responses/BadRequest'
        409:
          $ref: '#/components/responses/Conflict'
        503:
          description: Service Unavailable - Printer busy, command queued
  /api/printer/bed:
    post:
      summary: Control heated bed temperature
      description: |
        Accepts commands for bed temperature control. The API uses a flat command structure
        with discriminated unions based on the `command` field.

        **Commands:**
        - `target`: Set target temperature for heated bed (°C)
        - `offset`: Set temperature offset (°C)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/BedTargetCommand'
                - $ref: '#/components/schemas/BedOffsetCommand'
              discriminator:
                propertyName: command
                mapping:
                  target: '#/components/schemas/BedTargetCommand'
                  offset: '#/components/schemas/BedOffsetCommand'
            examples:
              target:
                summary: Set bed temperature to 75°C
                value:
                  command: target
                  target: 75
              offset:
                summary: Set bed temperature offset to +5°C
                value:
                  command: offset
                  offset: 5
      responses:
        204:
          description: Command accepted and executed successfully
        400:
          $ref: '#/components/responses/BadRequest'
        409:
          $ref: '#/components/responses/Conflict'
        503:
          description: Service Unavailable - Printer busy, command queued
components:
  schemas:
    Version:
      type: object
      properties:
        api:
          type: string
          example: 1.0.0
        version:
          type: string
          example: 0.7.0
        printer:
          type: string
          example: 1.3.1
        text:
          type: string
          example: PrusaLink 0.7.0
        firmware:
          type: string
          example: 3.10.1-4697
        sdk:
          type: string
          example: 0.7.0
        capabilities:
          description: 'Additional capabilities the printer has. The object is expected to

            be extended in the future with more capabilities. The absence of a

            capability in the object, or the complete absence of the object

            means the printer doesn''t support such capability (probably doesn''t

            even know such capability might exist).

            '
          type: object
          default: {}
          properties:
            upload-by-put:
              description: 'The printer supports uploading GCodes by the PUT method (as

                described in this document). It is capable of doing the PUT and

                HEAD to /api/files/{storage}/{path} and it is capable of

                answering the /api/v1/storage endpoint.


                In absence of this capability, client MAY opt to try the legacy

                "octoprint" POST to /api/files/{storage}.

                '
              type: boolean
              default: false
      required:
      - api
      - version
      - printer
      - text
      - firmware

    # ========================================
    # Movement Control Command Schemas
    # ========================================

    # Printhead Commands
    PrintheadJogCommand:
      type: object
      description: Jog (relative move) printhead in X/Y/Z axes
      required:
        - command
      properties:
        command:
          type: string
          enum: [jog]
          description: Command type identifier
        x:
          type: number
          description: X axis movement in mm (relative)
          example: 10
        y:
          type: number
          description: Y axis movement in mm (relative)
          example: -5
        z:
          type: number
          description: Z axis movement in mm (relative)
          example: 0.2
      additionalProperties: false

    PrintheadHomeCommand:
      type: object
      description: Home one or more axes to endstops
      required:
        - command
        - axes
      properties:
        command:
          type: string
          enum: [home]
          description: Command type identifier
        axes:
          type: array
          description: List of axes to home (lowercase x, y, z)
          items:
            type: string
            enum: [x, y, z]
          minItems: 1
          example: [x, y, z]
      additionalProperties: false

    PrintheadSpeedCommand:
      type: object
      description: Set print speed factor (percentage)
      required:
        - command
        - factor
      properties:
        command:
          type: string
          enum: [speed]
          description: Command type identifier
        factor:
          type: number
          description: Speed factor as percentage (100 = normal speed)
          minimum: 1
          maximum: 200
          example: 105
      additionalProperties: false

    PrintheadFeedrateCommand:
      type: object
      description: Set feedrate factor (percentage, alias for speed)
      required:
        - command
        - factor
      properties:
        command:
          type: string
          enum: [feedrate]
          description: Command type identifier
        factor:
          type: number
          description: Feedrate factor as percentage (100 = normal feedrate)
          minimum: 1
          maximum: 200
          example: 105
      additionalProperties: false

    PrintheadDisableSteppersCommand:
      type: object
      description: Disable all stepper motors
      required:
        - command
      properties:
        command:
          type: string
          enum: [disable_steppers]
          description: Command type identifier
      additionalProperties: false

    # Tool (Extruder/Nozzle) Commands
    ToolTargetCommand:
      type: object
      description: Set target temperature for nozzle
      required:
        - command
        - targets
      properties:
        command:
          type: string
          enum: [target]
          description: Command type identifier
        targets:
          type: object
          description: Target temperatures for each tool
          properties:
            tool0:
              type: number
              description: Target temperature for tool0 in °C
              minimum: 0
              maximum: 300
              example: 220
          required:
            - tool0
          additionalProperties: false
      additionalProperties: false

    ToolOffsetCommand:
      type: object
      description: Set temperature offset for nozzle
      required:
        - command
        - offsets
      properties:
        command:
          type: string
          enum: [offset]
          description: Command type identifier
        offsets:
          type: object
          description: Temperature offsets for each tool
          properties:
            tool0:
              type: number
              description: Temperature offset for tool0 in °C
              minimum: -50
              maximum: 50
              example: 5
          required:
            - tool0
          additionalProperties: false
      additionalProperties: false

    ToolSelectCommand:
      type: object
      description: Select active tool (for multi-extruder printers)
      required:
        - command
        - tool
      properties:
        command:
          type: string
          enum: [select]
          description: Command type identifier
        tool:
          type: string
          description: Tool identifier to select
          enum: [tool0, tool1, tool2, tool3]
          example: tool0
      additionalProperties: false

    ToolExtrudeCommand:
      type: object
      description: Extrude or retract filament (negative amount = retract)
      required:
        - command
        - amount
      properties:
        command:
          type: string
          enum: [extrude]
          description: Command type identifier
        amount:
          type: number
          description: Amount to extrude in mm (negative to retract)
          minimum: -100
          maximum: 100
          example: 5
      additionalProperties: false

    ToolFlowrateCommand:
      type: object
      description: Set extrusion flowrate factor (percentage)
      required:
        - command
        - factor
      properties:
        command:
          type: string
          enum: [flowrate]
          description: Command type identifier
        factor:
          type: number
          description: Flowrate factor as percentage (100 = normal flowrate)
          minimum: 75
          maximum: 125
          example: 95
      additionalProperties: false

    # Bed Commands
    BedTargetCommand:
      type: object
      description: Set target temperature for heated bed
      required:
        - command
        - target
      properties:
        command:
          type: string
          enum: [target]
          description: Command type identifier
        target:
          type: number
          description: Target temperature in °C
          minimum: 0
          maximum: 120
          example: 75
      additionalProperties: false

    BedOffsetCommand:
      type: object
      description: Set temperature offset for heated bed
      required:
        - command
        - offset
      properties:
        command:
          type: string
          enum: [offset]
          description: Command type identifier
        offset:
          type: number
          description: Temperature offset in °C
          minimum: -50
          maximum: 50
          example: 5
      additionalProperties: false

    Storage:
      type: object
      properties:
        name:
          type: string
          description: Name of the storage, based on selected language
          example: PrusaLink gcodes
        type:
          type: string
          description: Storage source
          enum:
          - LOCAL
          - SDCARD
          - USB
        path:
          type: string
          description: Path to storage (not display path)
          example: /local
        print_files:
          type: integer
          description: Size of all print files in bytes
          example: 19216842
        system_files:
          type: integer
          description: Size of all system files in bytes
          example: 4242
        free_space:
          type: integer
          description: System free space in bytes
          example: 1921681142
        total_space:
          type: integer
          description: System total space in bytes
          example: 8589934592
        available:
          type: boolean
          description: Whether the storage is available or not
          example: true
        read_only:
          type: boolean
          description: Whether the storage is read only
          example: false
      required:
      - available
      - path
      - type
    Camera:
      type: object
      properties:
        camera_id:
          type: string
          example: sh42arta
        config:
          type: object
          properties:
            path:
              type: string
              example: /dev/video0
            name:
              type: string
              example: Camera L4D
            driver:
              type: string
              example: V4L2
            resolution:
              type: string
              example: 1280x720
        connected:
          type: boolean
          description: Camera is successfully connected to PrusaLink
        detected:
          type: boolean
          description: Camera is detected by PrusaLink, but not saved yet
        stored:
          type: boolean
          description: Camera configuration is saved in PrusaLink
        linked:
          type: boolean
          description: Camera is linked to PrusaConnect
    CameraConfig:
      type: object
      description: Camera configuration
      properties:
        name:
          type: string
          description: Name of the camera
          example: MuadDib_Camera_1
        trigger_scheme:
          type: string
          description: When the snapshot is taken
          enum:
          - TEN_SEC
          - THIRTY_SEC
          - SIXTY_SEC
          - EACH_LAYER
          - FIFTH_LAYER
          - MANUAL
        available_resolutions:
          type: array
          items:
            type: object
            properties:
              width:
                type: integer
                example: 640
              height:
                type: integer
                example: 480
        resolution:
          type: object
          properties:
            width:
              type: integer
              example: 640
            height:
              type: integer
              example: 480
        focus:
          type: number
          description: Focus of the camera (0.0 - 1.0)
          example: 0.5
        capabilities:
          type: array
          items:
            type: string
            enum:
            - TRIGGER_SCHEME
            - IMAGING
            - RESOLUTION
            - ROTATION
            - EXPOSURE
            - FOCUS
    CameraConfigSet:
      type: object
      description: Camera configuration to set
      properties:
        name:
          type: string
          description: Name of the camera
          example: MuadDib_Camera_1
        trigger_scheme:
          type: string
          description: When the snapshot is taken
          enum:
          - TEN_SEC
          - THIRTY_SEC
          - SIXTY_SEC
          - EACH_LAYER
          - FIFTH_LAYER
          - MANUAL
        resolution:
          type: object
          properties:
            width:
              type: integer
              example: 640
            height:
              type: integer
              example: 640
        rotation:
          type: integer
          description: Current rotation of the output image
          example: 180
        focus:
          type: number
          description: Focus of the camera (0.0 - 1.0)
          example: 0.5
        exposure:
          type: number
          example: 4.2
        send_to_connect:
          type: boolean
          example: true
    GenericFileInfo:
      description: Basic file info object, common for all files
      type: object
      required:
      - name
      - read_only
      - type
      - m_timestamp
      properties:
        name:
          type: string
          description: Short Filename
          example: SPICE~1.gco
        read_only:
          type: boolean
          example: false
        size:
          type: integer
          description: Available for files only, not for folders
          example: 424242
        type:
          type: string
          description: File could be print file, firmware file, other (e.g. configuration) file, or folder
          enum:
          - PRINT_FILE
          - FIRMWARE
          - FILE
          - FOLDER
        m_timestamp:
          description: Timestamp in seconds
          type: integer
          example: 1648042843
        display_name:
          type: string
          description: Long Filename
          example: Spice_Harvester_0.3mm_PLA_MK3S_12m.gcode
    FileInfo:
      description: Other, not specified files info
      allOf:
      - $ref: '#/components/schemas/GenericFileInfo'
      - type: object
        properties:
          refs:
            type: object
            properties:
              download:
                type: string
                example: /api/files/local/file.txt/raw
    PrintFileInfoBasic:
      description: Simplified print file info within the folder's children
      allOf:
      - $ref: '#/components/schemas/GenericFileInfo'
      - type: object
        properties:
          refs:
            $ref: '#/components/schemas/PrintFileRefs'
    PrintFileRefs:
      description: Reference links for file thumbnail, icon and download
      type: object
      properties:
        download:
          type: string
          example: /api/files/local/examples/Spice_Harvester_0.3mm_PLA_MK3S_42m.gcode/raw
        icon:
          type: string
          example: /api/thumbnails/local/examples/Spice_Harvester_0.3mm_PLA_MK3S_42m.gcode.small.png
        thumbnail:
          type: string
          example: /api/thumbnails/local/examples/Spice_Harvester_0.3mm_PLA_MK3S_42m.gcode.orig.png
    PrintFileMetadata:
      type: object
      description: Print file metadata parsed from G-code or SL1, all data are optional
      properties:
        bed_temperature:
          type: integer
          description: Degrees Celsius
          example: 60
        bed_temperature per tool:
          type: array
          items:
            type: integer
            description: Degrees Celsius
            example: 60
        temperature:
          type: integer
          description: Nozzle temperature, Degrees Celsius
          example: 215
        temperature per tool:
          type: array
          items:
            type: integer
            description: Degrees Celsius
            example: 215
        brim_width:
          type: integer
          description: Millimeters
          example: 0
        estimated printing time (normal mode):
          type: string
          example: 42m 42s
        estimated_print_time:
          type: integer
          description: Seconds
          example: 25421
        faded_layers:
          type: integer
          example: 42
        filament cost:
          type: number
          example: 0.57
        filament cost per tool:
          type: array
          items:
            type: number
            example: 0.57
        filament used [cm3]:
          type: number
          example: 12.42
        filament used [cm3] per tool:
          type: array
          items:
            type: number
            example: 11.42
        filament used [g]:
          type: number
          example: 15.42
        filament used [g] per tool:
          type: array
          items:
            type: number
            example: 14.42
        filament used [mm]:
          type: number
          example: 5142.06
        filament used [mm] per tool:
          type: array
          items:
            type: number
            example: 4292.7
        filament_type:
          type: string
          example: PLA
        filament_type per tool:
          type: array
          items:
            type: string
            example: PLA
        fill_density:
          type: string
          description: Percents
          example: 20%
        initial_exposure_time:
          type: integer
          description: Seconds
          example: 5
        layer_height:
          type: number
          description: Millimeters
          example: 0.3
        material_name:
          type: string
          example: PLA Sandstorm Orange
        exposure_time:
          type: integer
          description: Seconds
          example: 2
        max_exposure_time:
          type: integer
          description: Seconds
          example: 3
        max_initial_exposure_time:
          type: integer
          description: Seconds
          example: 3
        min_exposure_time:
          type: integer
          description: Seconds
          example: 3
        min_initial_exposure_time:
          type: integer
          description: Seconds
          example: 1
        nozzle_diameter:
          type: number
          description: Millimeters
          example: 0.4
        nozzle_diameter per tool:
          type: array
          items:
            type: number
            description: Millimeters
            example: 0.4
        normal_percent_present:
          type: boolean
          example: true
        normal_left_present:
          type: boolean
          example: true
        quiet_percent_present:
          type: boolean
          example: true
        quiet_left_present:
          type: boolean
          example: true
        layer_info_present:
          type: boolean
          example: true
        max_layer_z:
          type: number
          example: 4.2
        print_time:
          type: integer
          description: Seconds
          example: 2542
        printer_model:
          type: string
          enum:
          - MK3
          - MK3S
          - MINI
        support_material:
          type: string
          example: PLA
        ironing:
          type: integer
          example: 0
        required_resin_ml:
          type: number
          example: 124.2
        profile:
          type: string
          example: ultra_fast
    PrintFileInfo:
      description: Full print file info from the file's detail
      allOf:
      - $ref: '#/components/schemas/PrintFileInfoBasic'
      - type: object
        properties:
          meta:
            $ref: '#/components/schemas/PrintFileMetadata'
    FirmwareFileInfoBasic:
      description: Simplified firmware file info within the folder's children
      allOf:
      - $ref: '#/components/schemas/GenericFileInfo'
      - type: object
        properties:
          refs:
            type: object
            properties:
              download:
                type: string
                example: /api/files/local/firmware.hex/raw
    FirmwareFileInfo:
      description: Full firmware file info from the file's detail
      allOf:
      - $ref: '#/components/schemas/FirmwareFileInfoBasic'
      - type: object
        properties:
          meta:
            type: object
            properties:
              version:
                type: string
                description: Firmware version in text format
              printer_type:
                type: integer
              printer_version:
                type: integer
    FolderInfo:
      description: Info about the folder and its content, except nested children
      allOf:
      - $ref: '#/components/schemas/GenericFileInfo'
      - type: object
        properties:
          children:
            type: array
            items:
              oneOf:
              - $ref: '#/components/schemas/FileInfo'
              - $ref: '#/components/schemas/PrintFileInfoBasic'
              - $ref: '#/components/schemas/FirmwareFileInfoBasic'
              - $ref: '#/components/schemas/FolderInfo'
    Info:
      type: object
      properties:
        mmu:
          type: boolean
          example: false
        name:
          type: string
          example: MuadDib
        location:
          type: string
          example: Arrakis
        farm_mode:
          type: boolean
          example: false
        nozzle_diameter:
          type: number
          example: 0.4
        min_extrusion_temp:
          type: integer
          example: 170
        serial:
          type: string
          example: CZPX4720X004XC34242
        sd_ready:
          type: boolean
          example: true
        active_camera:
          type: boolean
          example: true
        hostname:
          type: string
          example: prusa-mk3.lan
        port:
          type: string
          example: /dev/tty
        network_error_chime:
          type: boolean
          example: true
    StatusJob:
      type: object
      description: Telemetry info about current job, all values are optional
      properties:
        id:
          type: integer
          example: 420
        progress:
          type: number
          description: Percents
          example: 42.0
        time_remaining:
          type: integer
          description: Seconds
          example: 520
        time_printing:
          type: integer
          description: Seconds
          example: 526
    StatusPrinter:
      type: object
      description: Telemetry info about printer, all values except state are optional
      properties:
        state:
          type: string
          enum:
          - IDLE
          - BUSY
          - PRINTING
          - PAUSED
          - FINISHED
          - STOPPED
          - ERROR
          - ATTENTION
          - READY
        temp_nozzle:
          type: number
          example: 214.9
        target_nozzle:
          type: number
          example: 215.0
        temp_bed:
          type: number
          example: 59.5
        target_bed:
          type: number
          example: 60.0
        axis_x:
          type: number
          description: Available only when printer is not moving
          example: 23.2
        axis_y:
          type: number
          description: Available only when printer is not moving
          example: 24.3
        axis_z:
          type: number
          example: 0.5
        flow:
          type: integer
          example: 95
        speed:
          type: integer
          example: 100
        fan_hotend:
          type: integer
          example: 420
        fan_print:
          type: integer
          example: 420
        status_printer:
          type: object
          properties:
            ok:
              type: boolean
              example: true
            message:
              type: string
              example: OK
        status_connect:
          type: object
          properties:
            ok:
              type: boolean
              example: true
            message:
              type: string
              example: OK
      required:
      - state
    StatusTransfer:
      type: object
      description: Telemetry info about current transfer status, all values except id and time_transferring are optional
      properties:
        id:
          type: integer
          example: 72855542
        time_transferring:
          type: integer
          example: 30
        progress:
          type: number
          description: Percents
          example: 65.82
        data_transferred:
          type: integer
          example: 123084800
      required:
      - id
      - time_transferring
    StatusStorage:
      type: object
      description: Telemetry info about current storage status
      properties:
        name:
          type: string
          example: LOCAL
        path:
          type: string
          example: /local
        read_only:
          type: boolean
          example: false
        free_space:
          type: integer
          example: 4202335
      required:
      - name
      - path
      - read_only
    StatusCamera:
      type: object
      description: Telemetry info about default working camera, if available
      properties:
        id:
          type: string
          example: Ba1kmCbifTa8X
    PrusaLinkPackage:
      type: object
      description: PrusaLink package version available to update
      properties:
        new_version:
          type: string
          description: Package version available for update
          example: 4.2-RC1
    Settings:
      type: object
      description: Complete printer configuration settings
      properties:
        printer:
          type: object
          description: Printer identification and behavior settings
          properties:
            name:
              type: string
              description: Printer display name
              example: "My Prusa MK3S+"
            location:
              type: string
              description: Physical location description
              example: "Workshop"
            network_error_chime:
              type: boolean
              description: Enable sound alert on network errors
              example: true
        username:
          type: string
          description: Current username for digest authentication
          example: "maker"
        api-key:
          type: string
          description: API key for programmatic access
          example: "AbCdEf123456"
    SettingsUpdate:
      type: object
      description: Settings update request
      properties:
        printer:
          type: object
          description: Printer settings to update
          properties:
            name:
              type: string
              description: Printer display name
              minLength: 1
              maxLength: 64
              example: "Prusa MK3S+ (Workshop)"
            location:
              type: string
              description: Physical location description
              minLength: 1
              maxLength: 64
              example: "Main Workshop - Bay 3"
        network_error_chime:
          type: boolean
          description: Enable sound alert on network errors
          example: false
        user:
          type: object
          description: User credentials to update
          properties:
            password:
              type: string
              description: Current password (required for any user changes)
              example: "current-password"
            username:
              type: string
              description: New username
              minLength: 3
              maxLength: 32
              pattern: '^[a-zA-Z0-9]+$'
              example: "newusername"
            new_password:
              type: string
              description: New password
              minLength: 8
              example: "new-secure-password"
            new_repassword:
              type: string
              description: New password confirmation (must match new_password)
              minLength: 8
              example: "new-secure-password"
          required:
            - password
    ConnectionStatus:
      type: object
      description: PrusaConnect and printer connection status
      properties:
        connect:
          type: object
          description: PrusaConnect cloud service connection
          properties:
            hostname:
              type: string
              description: PrusaConnect server hostname
              example: "connect.prusa3d.com"
            port:
              type: integer
              description: Server port (0 for default)
              example: 0
            tls:
              type: integer
              description: Use TLS/HTTPS (1=yes, 0=no)
              enum: [0, 1]
              example: 1
            registration:
              type: string
              description: Registration status
              enum:
                - NOT_STARTED
                - IN_PROGRESS
                - FINISHED
                - FAILED
              example: "FINISHED"
        current:
          type: object
          description: Serial port connection to printer
          properties:
            port:
              type: string
              description: Serial port device path
              example: "/dev/ttyACM0"
            baudrate:
              type: integer
              description: Serial communication baud rate
              example: 115200
    Transfer:
      type: object
      properties:
        type:
          type: string
          enum:
          - NO_TRANSFER
          - FROM_WEB
          - FROM_CONNECT
          - FROM_PRINTER
          - FROM_SLICER
          - FROM_CLIENT
          - TO_CONNECT
          - TO_CLIENT
          example: FROM_WEB
        display_name:
          type: string
          description: Long Filename
          example: Spice_Harvester_0.3mm_PLA_MK3S_12m.gcode
        path:
          type: string
          example: /local
        url:
          type: string
          example: https://files.printables.com/media/prints/42/gcodes/42_b42-242-442-8142c-424242/spice_harvester_0.3mm_pla_mk3s_12m.gcode
        size:
          type: string
          description: Bytes
          example: 239314
        progress:
          type: number
          description: Percents
          example: 42.25
        transferred:
          type: integer
          description: Transferred data in bytes
          example: 3276800
        time_remaining:
          type: integer
          description: Seconds
          example: 61
        time_transferring:
          type: integer
          description: Seconds
          example: 42
        to_print:
          type: boolean
          description: Whether or not print after finishing transfer (upload)
          example: false
      required:
      - type
      - display_name
      - path
      - progress
      - transferred
      - time_transferring
      - to_print
    JobSerialPrint:
      type: object
      properties:
        serial_print:
          type: boolean
          description: Whether the printer is printing from the serial line
          default: false
    JobFilePrint:
      type: object
      properties:
        file:
          type: object
          properties:
            name:
              type: string
              description: Short Filename
              example: SPICE~1.gco
            display_name:
              type: string
              description: Long Filename
              example: Spice_Harvester_0.3mm_PLA_MK3S_12m.gcode
            path:
              type: string
              example: /local
            display_path:
              type: string
              example: /PrusaLink gcodes
            size:
              type: integer
              description: Bytes
              example: 2393142
            m_timestamp:
              description: Timestamp in seconds
              type: integer
              example: 1648042843
            meta:
              $ref: '#/components/schemas/PrintFileMetadata'
            refs:
              $ref: '#/components/schemas/PrintFileRefs'
          required:
          - name
          - path
          - m_timestamp
    Job:
      allOf:
      - oneOf:
        - $ref: '#/components/schemas/JobSerialPrint'
        - $ref: '#/components/schemas/JobFilePrint'
      - type: object
        properties:
          id:
            type: integer
            example: 420
          state:
            type: string
            enum:
            - PRINTING
            - PAUSED
            - FINISHED
            - STOPPED
            - ERROR
          progress:
            type: number
            description: Percents
            example: 42.0
          time_remaining:
            type: integer
            description: Seconds
            example: 520
          time_printing:
            type: integer
            description: Seconds
            example: 526
          inaccurate_estimates:
            type: boolean
            description: Whether the time estimates are accurate or inaccurate
            example: false
        required:
        - id
        - state
        - progress
        - time_printing
    Error:
      type: object
      properties:
        code:
          type: string
          description: Prusa error code. Must be string if we will have printer with code for example 04
          example: '10108'
        title:
          type: string
          description: Prusa error text string with prefilled variable macros.
          example: RESIN TOO LOW
        text:
          type: string
          description: Prusa error text string with prefilled variable macros.
          example: Measured resin volume 22.4 ml is lower than required for this print. Refill the tank and restart the print.
        url:
          type: string
          description: Link to the Prusa help page
          example: https://help.prusa3d.com/en/10108/LHE3Q0I1
      required:
      - title
      - text
    ResponsePlaintext:
      type: string
      default: Project with same name has been already uploaded.
      description: Prusa error message (raw_message)
  responses:
    NotModified:
      description: Not Modified
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    BadRequest:
      description: Bad Request
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Forbidden
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Not Found
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    RequestTimeout:
      description: Request Timeout
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Conflict:
      description: Conflict
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    UnsupportedMediaType:
      description: Unsupported Media Type
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Internal Server Error
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotImplemented:
      description: Not Implemented
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    ServiceUnavailable:
      description: Service Unavailable
      headers:
        Content-Location:
          $ref: '#/components/headers/Content-Location'
      content:
        text/plain:
          schema:
            $ref: '#/components/schemas/ResponsePlaintext'
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
  headers:
    Accept:
      required: false
      schema:
        type: string
        default: text/plain
      description: Parameter specifying supported data format from client. PCL has to support it. Slicer doesn't have to use
        this. If the header is not present, it defaults to text/plain
    Content-Location:
      schema:
        type: string
        default: http://<PCL IP>/error
      description: URI path to nice error page. We can send URI to help.prusa3d.com in the future.
  securitySchemes:
    digestAuth:
      type: http
      scheme: digest
